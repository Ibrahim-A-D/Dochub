<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocHub - Architecture Compl√®te 3 Phases</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .phase {
            background: white;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .phase-infra {
            border-top: 5px solid #3b82f6;
        }

        .phase-mco {
            border-top: 5px solid #10b981;
        }

        .phase-mcs {
            border-top: 5px solid #f59e0b;
        }

        .phase-header {
            padding: 20px;
            font-size: 1.4em;
            font-weight: bold;
            color: white;
        }

        .phase-infra .phase-header {
            background: #3b82f6;
        }

        .phase-mco .phase-header {
            background: #10b981;
        }

        .phase-mcs .phase-header {
            background: #f59e0b;
        }

        .phase-content {
            padding: 25px;
        }

        .nodes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .node-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
            overflow: hidden;
        }

        .node-header {
            background: #374151;
            color: white;
            padding: 15px;
            font-weight: bold;
            text-align: center;
        }

        .node-content {
            padding: 15px;
        }

        .service-item {
            background: white;
            padding: 10px;
            margin: 8px 0;
            border-radius: 5px;
            border-left: 3px solid #6366f1;
        }

        .config-block {
            background: #f8fafc;
            border-left: 4px solid #10b981;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .config-title {
            font-weight: bold;
            color: #059669;
            margin-bottom: 10px;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 13px;
        }

        .file-path {
            background: #3730a3;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .network-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .network-table th,
        .network-table td {
            border: 1px solid #e5e7eb;
            padding: 12px;
            text-align: left;
        }

        .network-table th {
            background: #f3f4f6;
            font-weight: bold;
        }

        .status-ok {
            color: #10b981;
            font-weight: bold;
        }

        .status-partial {
            color: #f59e0b;
            font-weight: bold;
        }

        .status-planned {
            color: #6b7280;
            font-weight: bold;
        }

        .highlight {
            background: #fef3c7;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .architecture-overview {
            background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è DocHub - Architecture 3 Phases</h1>
            <p>Infrastructure Kubernetes √† trois n≈ìuds - Vue d'ensemble compl√®te</p>
            <p><small>G√©n√©r√© le 12 Juin 2025</small></p>
        </div>

        <div class="architecture-overview">
            <h3>üéØ Vue d'ensemble Architecture</h3>
            <table class="network-table">
                <tr>
                    <th>N≈ìud</th>
                    <th>IP</th>
                    <th>R√¥le Principal</th>
                    <th>Phase 1</th>
                    <th>Phase 2</th>
                    <th>Phase 3</th>
                </tr>
                <tr>
                    <td><strong>Ma√Ætre</strong></td>
                    <td>192.168.56.10</td>
                    <td>Orchestration</td>
                    <td class="status-ok">‚úì K3s + Traefik</td>
                    <td class="status-ok">‚úì Prometheus/Grafana</td>
                    <td class="status-ok">‚úì Ansible + CIS</td>
                </tr>
                <tr>
                    <td><strong>Worker 1</strong></td>
                    <td>192.168.56.11</td>
                    <td>Serveur Web</td>
                    <td class="status-ok">‚úì DocHub + Nginx</td>
                    <td class="status-ok">‚úì Node Exporter</td>
                    <td class="status-ok">‚úì Container Security</td>
                </tr>
                <tr>
                    <td><strong>Worker 2</strong></td>
                    <td>192.168.56.12</td>
                    <td>Storage & S√©curit√©</td>
                    <td class="status-ok">‚úì NFS + Docker Registry</td>
                    <td class="status-ok">‚úì ELK Stack</td>
                    <td class="status-planned">‚è≥ Backup + Audit</td>
                </tr>
            </table>
        </div>

        <!-- PHASE 1: INFRASTRUCTURE -->
        <div class="phase phase-infra">
            <div class="phase-header">üèóÔ∏è Phase 1 - Infrastructure de Base</div>
            <div class="phase-content">

                <div class="nodes-grid">
                    <div class="node-card">
                        <div class="node-header">üéõÔ∏è N≈ìud Ma√Ætre - Orchestration</div>
                        <div class="node-content">
                            <div class="service-item"><strong>API Kubernetes</strong><br>Control plane K3s</div>
                            <div class="service-item"><strong>Ansible</strong><br>Automatisation d√©ploiement</div>
                            <div class="service-item"><strong>Traefik</strong><br>√âquilibreur de charge</div>
                        </div>
                    </div>

                    <div class="node-card">
                        <div class="node-header">üåê Worker 1 - Serveur Web</div>
                        <div class="node-content">
                            <div class="service-item"><strong>Worker Kubernetes</strong><br>N≈ìud de calcul</div>
                            <div class="service-item"><strong>Site Statique Nginx</strong><br>Serveur web principal
                            </div>
                            <div class="service-item"><strong>Documentation HTML</strong><br>Interface DocHub</div>
                        </div>
                    </div>

                    <div class="node-card">
                        <div class="node-header">üíæ Worker 2 - Storage & S√©curit√©</div>
                        <div class="node-content">
                            <div class="service-item"><strong>Worker Kubernetes</strong><br>N≈ìud de calcul</div>
                            <div class="service-item"><strong>Serveur de fichiers</strong><br>NFS pour stockage partag√©
                            </div>
                            <div class="service-item"><strong>Registre Docker</strong><br>Images containers priv√©es
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-block">
                    <div class="config-title">üìÇ Configuration Ansible - Inventaire</div>
                    <div class="file-path">~/dochub/ansible/inventory.yml</div>
                    <pre>all:
  children:
    master:
      hosts:
        192.168.56.10:
          ansible_user: ubuntu
          ansible_ssh_private_key_file: ~/.ssh/id_rsa
    web_servers:
      hosts:
        192.168.56.11:
          ansible_user: ubuntu
          ansible_ssh_private_key_file: ~/.ssh/id_rsa
    storage_servers:
      hosts:
        192.168.56.12:
          ansible_user: ubuntu
          ansible_ssh_private_key_file: ~/.ssh/id_rsa</pre>
                </div>

                <div class="config-block">
                    <div class="config-title">üöÄ DocHub Docker Compose</div>
                    <div class="file-path">roles/dochub/templates/docker-compose.yml.j2</div>
                    <pre>version: '3.8'
services:
  dochub:
    image: nginx:alpine
    container_name: dochub
    ports:
      - "{{ dochub_port }}:80"
    volumes:
      - /mnt/dochub:/usr/share/nginx/html:ro
    restart: unless-stopped

  docs-processor:
    image: python:3.9-alpine
    container_name: docs-processor
    volumes:
      - /mnt/dochub:/app/docs
    command: |
      sh -c "
        pip install markdown &&
        echo 'DocHub Ready' > /app/docs/index.html &&
        tail -f /dev/null
      "
    restart: unless-stopped</pre>
                </div>
            </div>
        </div>

        <!-- PHASE 2: MCO -->
        <div class="phase phase-mco">
            <div class="phase-header">üìä Phase 2 - MCO (Monitoring, Collecte, Observabilit√©)</div>
            <div class="phase-content">

                <div class="nodes-grid">
                    <div class="node-card">
                        <div class="node-header">üìà Ma√Ætre - Monitoring Central</div>
                        <div class="node-content">
                            <div class="service-item"><strong>Prometheus/Grafana</strong><br>Collecte et visualisation
                                m√©triques</div>
                            <div class="service-item"><strong>Monitoring Dashboard</strong><br>Interface centralis√©e
                            </div>
                            <div class="service-item"><strong>Syst√®me d'alertes</strong><br>Notifications automatiques
                            </div>
                        </div>
                    </div>

                    <div class="node-card">
                        <div class="node-header">üì° Worker 1 - Collecte M√©triques</div>
                        <div class="node-content">
                            <div class="service-item"><strong>Node Exporter</strong><br>M√©triques syst√®me</div>
                            <div class="service-item"><strong>Collecte de m√©triques</strong><br>CPU, RAM, disque, r√©seau
                            </div>
                            <div class="service-item"><strong>Agents de supervision</strong><br>Services applicatifs
                            </div>
                        </div>
                    </div>

                    <div class="node-card">
                        <div class="node-header">üìã Worker 2 - Gestion Logs</div>
                        <div class="node-content">
                            <div class="service-item"><strong>ELK Stack</strong><br>Elasticsearch, Logstash, Kibana
                            </div>
                            <div class="service-item"><strong>Gestion centralis√©e logs</strong><br>Agr√©gation et
                                indexation</div>
                            <div class="service-item"><strong>Analyse d'√©v√©nements</strong><br>D√©tection anomalies</div>
                        </div>
                    </div>
                </div>

                <div class="config-block">
                    <div class="config-title">üìä Configuration Prometheus</div>
                    <div class="file-path">roles/monitoring/templates/prometheus.yml.j2</div>
                    <pre>global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "rules/*.yml"

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'node-exporter'
    static_configs:
      - targets: 
        - '192.168.56.10:9100'
        - '192.168.56.11:9100'
        - '192.168.56.12:9100'

  - job_name: 'kubernetes'
    static_configs:
      - targets: ['192.168.56.10:6443']</pre>
                </div>

                <div class="config-block">
                    <div class="config-title">üìà Stack ELK</div>
                    <div class="file-path">roles/elk/templates/docker-compose-elk.yml.j2</div>
                    <pre>version: '3.8'
services:
  elasticsearch:
    image: elasticsearch:8.8.0
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    ports:
      - "9200:9200"
    volumes:
      - elk_data:/usr/share/elasticsearch/data

  logstash:
    image: logstash:8.8.0
    volumes:
      - ./logstash.conf:/usr/share/logstash/pipeline/logstash.conf
    ports:
      - "5044:5044"

  kibana:
    image: kibana:8.8.0
    ports:
      - "5601:5601"
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200

volumes:
  elk_data:</pre>
                </div>
            </div>
        </div>

        <!-- PHASE 3: MCS -->
        <div class="phase phase-mcs">
            <div class="phase-header">üîí Phase 3 - MCS (Monitoring, Contr√¥le, S√©curit√©)</div>
            <div class="phase-content">

                <div class="nodes-grid">
                    <div class="node-card">
                        <div class="node-header">ü§ñ Ma√Ætre - Automatisation S√©curis√©e</div>
                        <div class="node-content">
                            <div class="service-item"><strong>Ansible Automation</strong><br>Orchestration s√©curis√©e
                            </div>
                            <div class="service-item"><strong>Gestion mises √† jour</strong><br>D√©ploiements automatis√©s
                            </div>
                            <div class="service-item"><strong>Durcissement CIS</strong><br>Standards de s√©curit√©</div>
                        </div>
                    </div>

                    <div class="node-card">
                        <div class="node-header">üõ°Ô∏è Worker 1 - S√©curisation Services</div>
                        <div class="node-content">
                            <div class="service-item"><strong>S√©curisation containers</strong><br>Politiques de s√©curit√©
                            </div>
                            <div class="service-item"><strong>S√©curisation Nginx</strong><br>Configuration durcie</div>
                            <div class="service-item"><strong>Moindre privil√®ge</strong><br>Acc√®s restreints</div>
                        </div>
                    </div>

                    <div class="node-card">
                        <div class="node-header">üîç Worker 2 - Audit & Backup</div>
                        <div class="node-content">
                            <div class="service-item"><strong>Audit de s√©curit√©</strong><br>Surveillance continue</div>
                            <div class="service-item"><strong>Backup & Restore</strong><br>Sauvegarde automatis√©e</div>
                            <div class="service-item"><strong>Scan vuln√©rabilit√©s</strong><br>Analyse r√©guli√®re</div>
                        </div>
                    </div>
                </div>

                <div class="config-block">
                    <div class="config-title">üîí Politiques de S√©curit√© Kubernetes</div>
                    <div class="file-path">security/pod-security-policy.yml</div>
                    <pre>apiVersion: policy/v1beta1
kind: PodSecurityPolicy
metadata:
  name: dochub-psp
spec:
  privileged: false
  allowPrivilegeEscalation: false
  requiredDropCapabilities:
    - ALL
  volumes:
    - 'configMap'
    - 'emptyDir'
    - 'projected'
    - 'secret'
    - 'downwardAPI'
    - 'persistentVolumeClaim'
  runAsUser:
    rule: 'MustRunAsNonRoot'
  seLinux:
    rule: 'RunAsAny'
  fsGroup:
    rule: 'RunAsAny'</pre>
                </div>

                <div class="config-block">
                    <div class="config-title">üìã Script Audit S√©curit√©</div>
                    <div class="file-path">security/audit-security.sh</div>
                    <pre>#!/bin/bash
# Audit de s√©curit√© DocHub

echo "=== Audit S√©curit√© DocHub ==="

# V√©rification containers privil√©gi√©s
echo "1. Containers privil√©gi√©s:"
docker ps --format "table {{.Names}}\t{{.Status}}" | grep -E "(privileged|root)"

# Scan ports ouverts
echo "2. Ports expos√©s:"
nmap -sS localhost

# V√©rification certificats
echo "3. Certificats SSL:"
kubectl get certificates -A

# Analyse vuln√©rabilit√©s images
echo "4. Scan images:"
trivy image nginx:alpine

# Audit logs Kubernetes
echo "5. Logs audit K3s:"
journalctl -u k3s --since "1 hour ago" | grep -i "denied\|failed\|error"</pre>
                </div>

                <div class="config-block">
                    <div class="config-title">üíæ Configuration Backup</div>
                    <div class="file-path">backup/backup-dochub.yml</div>
                    <pre>---
- name: Backup DocHub complet
  hosts: all
  tasks:
    - name: Backup configuration K3s
      archive:
        path: /etc/rancher/k3s
        dest: "/backup/k3s-config-{{ ansible_date_time.date }}.tar.gz"
      when: inventory_hostname in groups['master']

    - name: Backup donn√©es NFS
      synchronize:
        src: /opt/dochub/shared/
        dest: "/backup/nfs-data-{{ ansible_date_time.date }}/"
      when: inventory_hostname in groups['storage_servers']

    - name: Backup containers
      shell: |
        docker save nginx:alpine | gzip > /backup/nginx-{{ ansible_date_time.date }}.tar.gz
        docker save python:3.9-alpine | gzip > /backup/python-{{ ansible_date_time.date }}.tar.gz</pre>
                </div>
            </div>
        </div>

        <!-- √âTAT GLOBAL -->
        <div class="phase">
            <div class="phase-header" style="background: #6b7280;">üìä √âtat Global du Projet</div>
            <div class="phase-content">

                <div class="config-block">
                    <div class="config-title">üéØ Statut par Phase</div>
                    <table class="network-table">
                        <tr>
                            <th>Phase</th>
                            <th>Ma√Ætre</th>
                            <th>Worker 1</th>
                            <th>Worker 2</th>
                            <th>Avancement</th>
                        </tr>
                        <tr>
                            <td><strong>Phase 1 - Infrastructure</strong></td>
                            <td class="status-ok">‚úì Termin√©</td>
                            <td class="status-ok">‚úì Termin√©</td>
                            <td class="status-ok">‚úì Termin√©</td>
                            <td>100%</td>
                        </tr>
                        <tr>
                            <td><strong>Phase 2 - MCO</strong></td>
                            <td class="status-ok">‚úì Termin√©</td>
                            <td class="status-ok">‚úì Termin√©</td>
                            <td class="status-ok">‚úì Termin√©</td>
                            <td>100%</td>
                        </tr>
                        <tr>
                            <td><strong>Phase 3 - MCS</strong></td>
                            <td class="status-ok">‚úì Termin√©</td>
                            <td class="status-ok">‚úì Termin√©</td>
                            <td class="status-partial">‚ö† En cours</td>
                            <td>75%</td>
                        </tr>
                    </table>
                </div>

                <div class="config-block">
                    <div class="config-title">üîß Actions Imm√©diates</div>
                    <pre># Phase 3 - Finalisation Worker 2
ansible storage_servers -m shell -a "apt-get install -y borgbackup rsync"

# Configuration audit automatis√©
ansible storage_servers -m shell -a "mkdir -p /opt/audit && chmod 700 /opt/audit"

# D√©ploiement script de backup
ansible-playbook backup/backup-dochub.yml --limit storage_servers

# V√©rification compl√®te
kubectl get nodes
curl http://192.168.56.11:8080
curl http://192.168.56.12:5601</pre>
                </div>

                <div class="config-block">
                    <div class="config-title">üó∫Ô∏è Roadmap Prochaines √âtapes</div>
                    <ol style="margin-left: 20px;">
                        <li><strong>Finaliser Phase 3 Worker 2</strong> : Impl√©menter syst√®me de backup automatis√©</li>
                        <li><strong>Audit de s√©curit√©</strong> : Configurer scan de vuln√©rabilit√©s sur Worker 2</li>
                        <li><strong>Documentation</strong> : Finaliser proc√©dures de restauration</li>
                        <li><strong>Tests de charge</strong> : Valider la performance de l'infrastructure compl√®te</li>
                        <li><strong>Formation</strong> : Pr√©parer guides d'utilisation pour les √©quipes</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div style="text-align: center; margin-top: 40px; padding: 20px; background: white; border-radius: 10px;">
            <p><strong>üèóÔ∏è DocHub - Architecture 3 Phases</strong></p>
            <p>Infrastructure : 3 VMs Ubuntu ‚Ä¢ Orchestrateur : K3s ‚Ä¢ Storage : NFS ‚Ä¢ Monitoring : Prometheus/ELK</p>
            <p><small>Document technique complet - Derni√®re mise √† jour : 12/06/2025</small></p>
        </div>
    </div>
</body>

</html>